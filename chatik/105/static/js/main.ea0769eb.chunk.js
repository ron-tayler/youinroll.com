(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{12:function(e,t,a){},66:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a(25),n=a.n(c),o=a(3),r=(a(12),a(5)),i=a.n(r),l=a(13),u=a.n(l),j=a(2),d=Object(s.createContext)();function h(e){var t=Object(s.useState)(null),a=Object(o.a)(t,2),c=a[0],n=a[1],r=Object(s.useState)(""),l=Object(o.a)(r,2),h=l[0],p=l[1],m=Object(s.useState)(""),b=Object(o.a)(m,2),g=b[0],f=b[1],O=u.a.get("PHPSESSID"),v=u.a.get();return Object(s.useEffect)((function(){g||i.a.get("https://youinroll.com/lib/ajax/getToken.php",{withCredentials:!0,headers:{Cookie:"PHPSESSID=".concat(O,";")}}).then((function(e){console.log(e),e&&e.data&&f(e.data.token)})).catch((function(e){return console.log(e)})),c&&(localStorage.setItem("loggeduserid",c),i.a.get("https://youinroll.com/profile/".concat(c,"/info?api=v1.1")).then((function(e){var t=e.data.response,a="";a=t.avatar.startsWith("https")?t.avatar:t.avatar.startsWith("uploads")?"https://react.semantic-ui.com/images/wireframe/square-image.png":"https://youinroll.com/"+t.avatar,t.avatar=a,p(t)})).catch((function(e){return console.log(e)})))}),[c,O,v]),Object(j.jsx)(d.Provider,{value:{user:c,token:g,userdata:h,setUser:n},children:e.children})}var p=a(27),m=function(){return Object(j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-send",children:[Object(j.jsx)("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),Object(j.jsx)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})};function b(){var e=Object(s.useState)(""),t=Object(o.a)(e,2),a=t[0],c=t[1],n=Object(s.useContext)(d).token,r=window.location.href.split("/")[4],l=Object(s.useState)(localStorage.getItem("stream-".concat(r))||!1),u=Object(o.a)(l,2),h=(u[0],u[1],function(){/\S/.test(a)&&i.a.post("https://youinroll.com/message/send?api=1.0",{peer_id:"s".concat(r),message:a,access_token:n}).then((function(e){console.log(e),c("")})).catch((function(e){console.log(e)}))});return Object(j.jsx)("form",{onSubmit:function(e){e.preventDefault(),h()},children:Object(j.jsxs)("div",{className:"chatFooter",children:[Object(j.jsx)(p.a,{value:a,className:"messageImput",onChange:function(e){return c(e)},cleanOnEnter:!0,onFocus:function(){var e=document.getElementsByClassName("react-emoji")[0];e.style.background="white",e.style.border="2px solid #9147ff ",(e=document.getElementsByClassName("react-input-emoji--wrapper")[0]).style.background="white"},onEnter:h,placeholder:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",groupNames:{smileys_people:"\u041f\u0440\u043e\u0441\u0442\u044b\u0435 \u0441\u043c\u0430\u0439\u043b\u044b",animals_nature:"\u0416\u0438\u0432\u043e\u0442\u043d\u044b\u0435 \u043f\u0440\u0438\u0440\u043e\u0434\u0430",food_drink:"\u0415\u0434\u0430 \u0438 \u043d\u0430\u043f\u0438\u0442\u043a\u0438",travel_places:"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f",activities:"\u0421\u043f\u043e\u0440\u0442",objects:"\u041e\u0431\u044a\u0435\u043a\u0442\u044b",symbols:"\u0421\u0438\u043c\u0432\u043e\u043b\u044b",flags:"\u0424\u043b\u0430\u0433\u0438"}}),Object(j.jsx)("div",{className:"messageSend",children:Object(j.jsx)("button",{className:"footerButton",type:"submit",children:Object(j.jsx)(m,{})})})]})})}var g=a(6),f=a.n(g),O=a(7),v=a(9),x=a(26);function y(e){var t=e.mseg,a=Object(s.useState)(null),c=Object(o.a)(a,2),n=c[0],r=c[1];return Object(s.useEffect)((function(){i.a.get("https://youinroll.com/profile/".concat(t.user_id,"/info?api=v1.1")).then((function(e){var t=e.data.response,a="";a=t.avatar.startsWith("https")?t.avatar:t.avatar.startsWith("uploads")?"https://react.semantic-ui.com/images/wireframe/square-image.png":"https://youinroll.com/"+t.avatar,t.avatar=a,r(t)})).catch((function(e){return console.log(e)}))}),[]),Object(j.jsx)("div",{className:"chatMsg",children:Object(j.jsxs)("span",{className:"authorSpan",children:[n&&Object(j.jsx)("img",{className:"chatMsgImg",src:n.avatar,alt:n.name}),Object(j.jsxs)("span",{children:[n&&Object(j.jsx)("b",{className:"userNamedec",children:"".concat(n.name.trim(),": ")}),Object(j.jsx)(x.EmojioneV4,{svg:!0,text:t.message})]})]})})}function S(e){var t=e.toscroll,a=Object(s.useState)([]),c=Object(o.a)(a,2),n=c[0],r=c[1],l=Object(s.useState)(0),u=Object(o.a)(l,2),d=u[0],h=u[1],p=Object(s.useState)(!1),m=Object(o.a)(p,2),b=m[0],g=m[1],x=Object(s.useRef)(null),S=function(){var e=document.getElementById("chatmsgsall");e.scrollTop=e.scrollHeight},w=window.location.href.split("/")[4];function k(){return N.apply(this,arguments)}function N(){return(N=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("in getrecent"),i.a.get("https://youinroll.com/listen/stream?api=1.0&stream_id=".concat(w,"&ts=").concat(d)).then((function(e){if(console.log(e),e.data&&"timeout"===e.data.response)console.log("timeout");else if(e.data&&e.data.response&&Array.isArray([e.data.response])){console.log("Is array");var a=e.data.response.slice(0,parseInt(e.data.response[0].id)-d);r([].concat(Object(O.a)(n),Object(O.a)(a.reverse()))),h(parseInt(e.data.response[0].id)),t&&S()}g(!b)})).catch((function(e){console.log(e),g(!b)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(s.useEffect)((function(){if(console.log("in useeffect chatmain"),0===d&&0===n.length){var e={user_id:456,message:"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u043a\u043e\u043c\u043d\u0430\u0442\u0443 \u043f\u0440\u044f\u043c\u043e\u0433\u043e \u044d\u0444\u0438\u0440\u0430 \u0432 YouinRoll! \u041e\u0431\u0449\u0430\u0439\u0442\u0435\u0441\u044c \u0441 \u0432\u0435\u0434\u0443\u0449\u0438\u043c \u0438 \u0437\u0440\u0438\u0442\u0435\u043b\u044f\u043c\u0438 \u0438 \u043d\u0435 \u0437\u0430\u0431\u044b\u0432\u0430\u0439\u0442\u0435 \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430, \u0447\u0442\u043e\u0431\u044b \u044d\u0442\u0430 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u044f \u0431\u044b\u043b\u0430 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0439 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430."};i.a.get("https://youinroll.com/message/getAll?api=1.0&peer_id=s".concat(w)).then((function(a){if(a.data.response.length>0){h(parseInt(a.data.response[0].id));var s=a.data.response.slice(0,parseInt(a.data.response[0].id)-d);r([].concat(Object(O.a)(n),Object(O.a)(s.reverse()),[e]))}else r([e]),k();g(!b),t&&S()})).catch((function(e){console.log(e)}))}else k()}),[b]),Object(j.jsxs)(j.Fragment,{children:[n.map((function(e){return Object(j.jsx)(y,{mseg:e},e.id)})),Object(j.jsx)("div",{ref:x})]})}function w(){return Object(j.jsx)("div",{className:"chatHeader",children:Object(j.jsx)("div",{children:Object(j.jsx)("h3",{children:"\u0427\u0410\u0422 \u0422\u0420\u0410\u041d\u0421\u041b\u042f\u0426\u0418\u0418"})})})}function k(){var e=Object(s.useState)(!0),t=Object(o.a)(e,2),a=t[0],c=(t[1],Object(s.useState)(window.scrollY)),n=Object(o.a)(c,2);n[0],n[1];return Object(j.jsx)(h,{children:Object(j.jsx)("div",{className:"App",children:Object(j.jsxs)("div",{className:"chatWrapper",children:[Object(j.jsx)(w,{}),Object(j.jsx)("div",{className:"chatmain",id:"chatmsgsall",onScroll:function(e){console.log(e)},children:Object(j.jsx)(S,{toscroll:a})}),Object(j.jsx)(b,{})]})})})}var N=document.getElementById("chatik");n.a.render(Object(j.jsx)(s.StrictMode,{children:Object(j.jsx)(k,{})}),N)}},[[66,1,2]]]);
//# sourceMappingURL=main.ea0769eb.chunk.js.map