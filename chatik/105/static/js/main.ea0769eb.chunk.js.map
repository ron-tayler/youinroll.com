{"version":3,"sources":["UserContext.js","ChatFooter.js","ChatMain.js","App.js","index.js"],"names":["UserContext","createContext","UserContextProvider","props","useState","userid","setUser","userdata","setUserData","token","setToken","phpsession","Cookies","get","all_cooks","useEffect","axios","withCredentials","headers","Cookie","then","res","console","log","data","catch","e","localStorage","setItem","resp","uData","response","avaurl","avatar","startsWith","err","Provider","value","user","children","SendIcon","xmlns","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","className","x1","y1","x2","y2","points","ChatFooter","chatMessage","setChatMessage","useContext","stream_id","window","location","href","split","getItem","postMsg","test","post","peer_id","message","access_token","error","onSubmit","event","preventDefault","onChange","cleanOnEnter","onFocus","reactEm","document","getElementsByClassName","style","background","border","onEnter","placeholder","groupNames","smileys_people","animals_nature","food_drink","travel_places","activities","objects","symbols","flags","type","ChatMessage","mseg","userData","user_id","src","alt","name","trim","svg","text","ChatMain","toscroll","msgs","setMsgs","offset","setOffSet","toRebuild","setToRebuild","myRef","useRef","scrollChatMain","objDiv","getElementById","scrollTop","scrollHeight","getRecent","a","Array","isArray","newMsgs","slice","parseInt","id","reverse","er","length","firstMessage","map","msg","ref","ChatHeader","App","scrollY","onScroll","chatElement","ReactDOM","render"],"mappings":"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","file":"static/js/main.ea0769eb.chunk.js","sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport Cookies from 'js-cookie';\n\nexport const UserContext = createContext();\n\nexport default function UserContextProvider(props){\n\n\n\n    const [ userid, setUser ] = useState(null);  // localStorage.getItem('loggeduserid') || \"\"\n    const [ userdata, setUserData ] = useState(\"\");\n    const [ token, setToken ] = useState(\"\");\n\n    const phpsession = Cookies.get('PHPSESSID');\n\n    const all_cooks = Cookies.get();\n\n    \n\n    \n  \n    useEffect(() => { \n\n        /* for (const property in all_cooks) {\n            console.log(`${property}: ${all_cooks[property]}`);\n            property[0] !== '_' && property !== 'PHPSESSID' && property.length > 8 && setUser(all_cooks[property]);\n        } */\n\n        if (!token)\n            {axios\n                .get(\"https://youinroll.com/lib/ajax/getToken.php\",\n                        { \n                        withCredentials: true,\n                        headers: { Cookie: `PHPSESSID=${phpsession};`}\n                    })\n                .then((res) => {\n                    console.log(res)\n                    res && res.data && setToken(res.data.token);\n                   // res && res.data && res.data.token && localStorage.setItem('token', res.data.token);\n                })\n                .catch((e) =>  console.log(e)); \n            }\n        \n        \n        if (userid){\n            localStorage.setItem('loggeduserid', userid)        \n            axios.get(`https://youinroll.com/profile/${userid}/info?api=v1.1`)\n            .then((resp) => {\n                let uData = resp.data.response;\n                let avaurl = \"\";\n                if (uData.avatar.startsWith('https')){\n                    avaurl = uData.avatar;\n                }else if (uData.avatar.startsWith('uploads')){\n                    avaurl = 'https://react.semantic-ui.com/images/wireframe/square-image.png';\n                }\n                else{\n                    avaurl = \"https://youinroll.com/\" + uData.avatar;\n                };\n                uData.avatar = avaurl;                \n                setUserData(uData);                \n            })\n            .catch((err) => console.log(err))\n        }\n    }, [userid, phpsession, all_cooks])\n    \n    return(\n        <UserContext.Provider value={{user: userid, token, userdata, setUser}}>\n            {props.children}\n        </UserContext.Provider>\n    );\n}","import \"./styles.css\";\n//import EmojiPicker from \"./EmojiPicker\";\nimport { useState, useContext } from \"react\";\nimport axios from \"axios\";\nimport { UserContext } from './UserContext';\nimport InputEmoji from \"react-input-emoji\";\n\n\nconst SendIcon = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    stroke=\"currentColor\"\n    strokeWidth=\"2\"\n    strokeLinecap=\"round\"\n    strokeLinejoin=\"round\"\n    className=\"feather feather-send\"\n  >\n    <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n    <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\n  </svg>\n);\n\nexport default function ChatFooter() {\n  const [chatMessage, setChatMessage] = useState(\"\");\n  const {token} = useContext(UserContext);\n  // const stream_id = 123;\n  const stream_id = window.location.href.split('/')[4];\n  const [ rulesaccept, setRulesAccept ] = useState(localStorage.getItem(`stream-${stream_id}`) || false);\n\n  \n  const checkRulesAccept = () => {\n    console.log(\"dsa\");\n  }\n\n \n\n\n\n  const postMsg = () => {\n    if (/\\S/.test(chatMessage)) {     \n      axios\n        .post(`https://youinroll.com/message/send?api=1.0`, {\n          peer_id: `s${stream_id}`,\n          message: chatMessage,\n          access_token: token,\n            //\"50d56c2af74e7f0656fcfa28d663a94c9e338a6e5b9825ab2749d95e8895420137628a75d3a2d99ab1b0756ff9872cfdb555e1dc3cc48ae6fa454c44b0bfd5ee\"\n        })\n        .then(function (response) {\n          console.log(response);\n          setChatMessage(\"\");\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    }\n\n  }\n\n  const sendData = (event) => {   \n    event.preventDefault();\n    postMsg();\n  };\n\n  const onFocusClass = () => {\n    let reactEm = document.getElementsByClassName('react-emoji')[0];\n    reactEm.style.background = \"white\";\n    reactEm.style.border = \"2px solid #9147ff \";\n    \n    reactEm = document.getElementsByClassName('react-input-emoji--wrapper')[0];\n    reactEm.style.background = \"white\";    \n  }\n\n  \n\n  return (\n    <form onSubmit={sendData}>\n      <div className=\"chatFooter\"> \n        <InputEmoji\n          value={chatMessage}\n          className=\"messageImput\"\n          onChange={(e) => setChatMessage(e)}\n          cleanOnEnter\n          onFocus={onFocusClass}\n          onEnter={postMsg}\n          placeholder=\"Отправить сообщение\"\n          groupNames={{\n            smileys_people: \"Простые смайлы\",\n            animals_nature: \"Животные природа\",\n            food_drink: \"Еда и напитки\",\n            travel_places: \"Путешествия\",\n            activities: \"Спорт\",\n            objects: \"Объекты\",\n            symbols: \"Символы\",\n            flags: \"Флаги\"\n          }}\n        />\n\n        {/* <input\n          className=\"messageImput\"\n          placeholder=\"Сообщение\"\n          value={chatMessage}        \n          onChange={(e) => setChatMessage(e.target.value)}\n          onKeyDown={pressEnter}\n         \n        /> */}\n        {/* <div className=\"emojidiv\">\n          <EmojiPicker addEmoji={addEmoji} />\n        </div>  */}\n        <div className=\"messageSend\">\n          <button className=\"footerButton\" type=\"submit\">\n            <SendIcon />\n          </button>\n        </div>        \n      </div>\n    </form>\n  );\n}\n","import \"./styles.css\";\nimport { useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\n\nimport {  EmojioneV4 } from \"react-emoji-render\";\n\n\n\n\nfunction ChatMessage({ mseg }) {\n\n  const [ userData, setUserData ] = useState(null);\n  \n  useEffect(() => {\n    axios.get(`https://youinroll.com/profile/${mseg.user_id}/info?api=v1.1`)\n              .then((resp) => {\n                  let uData = resp.data.response;\n                //  console.log(resp);\n                  let avaurl = \"\";\n                  if (uData.avatar.startsWith('https')){\n                      avaurl = uData.avatar;\n                  }else if (uData.avatar.startsWith('uploads')){\n                      avaurl = 'https://react.semantic-ui.com/images/wireframe/square-image.png';\n                  }\n                  else{\n                      avaurl = \"https://youinroll.com/\" + uData.avatar;\n                  };\n                  uData.avatar = avaurl; \n                  \n                 // console.log(uData);\n                  setUserData(uData);                \n              })\n              .catch((err) => console.log(err))\n  },[]);\n\n  return (\n    <div className=\"chatMsg\">\n      <span className=\"authorSpan\"> \n        {userData && <img  className=\"chatMsgImg\" src={userData.avatar} alt={userData.name} />}\n        <span>\n          {userData && <b className=\"userNamedec\">{`${userData.name.trim()}: `}</b> }\n          <EmojioneV4 svg text={mseg.message} />\n        </span>\n      </span>      \n    </div>\n  );\n}\n\nexport default function ChatMain({ toscroll }) {\n  const [msgs, setMsgs] = useState([]); // page messages\n  const [offset, setOffSet] = useState(0);\n  const [ toRebuild, setToRebuild ] = useState(false);\n  const myRef = useRef(null);\n  // const executeScroll = () => myRef.current.scrollIntoView() \n  const scrollChatMain = () => {\n    let objDiv = document.getElementById(\"chatmsgsall\");\n    objDiv.scrollTop = objDiv.scrollHeight;\n  };\n\n // const stream_id = 123;\n  const stream_id = window.location.href.split('/')[4];\n\n\n  \n  async function getRecent() { \n    console.log('in getrecent');\n    axios.get(`https://youinroll.com/listen/stream?api=1.0&stream_id=${stream_id}&ts=${offset}`)\n      .then((response) => { \n        console.log(response); \n        if (response.data && response.data.response === \"timeout\"){\n            console.log(\"timeout\")  \n        } else if (response.data && response.data.response && Array.isArray([response.data.response])) {\n          console.log(\"Is array\");\n          let newMsgs = response.data.response.slice(0, parseInt(response.data.response[0].id) - offset);\n          setMsgs([...msgs, ...newMsgs.reverse()] );\n          setOffSet(parseInt(response.data.response[0].id))          \n          toscroll && scrollChatMain();\n        }        \n        setToRebuild(!toRebuild);\n      })\n      .catch((er) => {\n        console.log(er);\n        setToRebuild(!toRebuild);\n      })\n  }\n   \n\n  useEffect(() => {\n    console.log('in useeffect chatmain');\n    if (offset === 0 && msgs.length === 0) // if offset is 0 and there are no messages on page got to getAll endpoint\n    {\n      let firstMessage = {\n        user_id: 456,\n        message: 'Добро пожаловать в комнату прямого эфира в YouinRoll! Общайтесь с ведущим и зрителями и не забывайте соблюдать правила сообщества, чтобы эта трансляция была безопасной для просмотра.'\n      };\n      axios \n        .get( `https://youinroll.com/message/getAll?api=1.0&peer_id=s${stream_id}`\n        // `https://youinroll.com/listen/stream?api=1.0&stream_id=s${stream_id}&access_token=${access_token}`\n        )\n        .then((response) => {  \n          \n          if (response.data.response.length > 0){           \n            setOffSet(parseInt(response.data.response[0].id));\n            let newMsgs = response.data.response.slice(0, parseInt(response.data.response[0].id) - offset);\n            setMsgs([...msgs, ...newMsgs.reverse(), firstMessage] );                   \n            //console.log(response.data.response[0].id)\n          } else {\n            setMsgs([firstMessage] );\n            getRecent();\n          }\n          setToRebuild(!toRebuild);\n          toscroll && scrollChatMain();    \n        // console.log(response.data.response[-1]);            \n        })              \n        .catch((error) => {\n          console.log(error);          \n        });\n    }else {\n      // got to listen stream endpoint if there is at least one message (for example from help)\n      getRecent();\n    }\n     \n  }, [toRebuild]);\n\n  return (\n    <>\n      {msgs.map((msg) => (\n        <ChatMessage key={msg.id} mseg={msg}  />\n      ))}\n      <div ref={myRef}></div>  \n    </>\n  );\n}\n","import  { useState } from \"react\";\nimport ChatFooter from \"./ChatFooter\";\nimport \"./styles.css\";\nimport ChatMain from \"./ChatMain\";\nimport UserContextProvider from \"./UserContext\";\n\n// import { useEffect } from \"react\";\n\n// import RocketChatApi from 'rocketchat-api';\n\n//const rocketChatClient = new RocketChatApi('http','chat.smartfooded.com',3000);\n\nfunction ChatHeader() {\n  return (\n    <div className=\"chatHeader\">\n      <div>\n        <h3>ЧАТ ТРАНСЛЯЦИИ</h3>\n      </div>\n     {/*  <div className=\"chatHeaderImg\">\n        <img\n          src={window.streamimg  ? window.streamimg : \"https://youinroll.com/storage/media/ac9ff41aee4b2ebd3ea900551bb2bce6-1.jpg\"}\n          alt=\"Stream Image\"\n        />\n      </div> */}\n    </div>\n  );\n}\n\nexport default function App() {\n\n  const [ toscroll, setToScroll ] = useState(true);\n  const [y, setY] = useState(window.scrollY);\n  \n  const scrollDownButton = (event) => {\n    console.log(event);\n  }\n\n  return (\n    <UserContextProvider>\n      <div className=\"App\">\n        <div className=\"chatWrapper\">\n          <ChatHeader />\n          <div className=\"chatmain\" id=\"chatmsgsall\" onScroll={scrollDownButton}>\n            <ChatMain  toscroll={toscroll} />            \n          </div>\n          <ChatFooter />\n        </div>\n      </div>\n    </UserContextProvider>\n  );\n}\n","import { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nconst chatElement = document.getElementById(\"chatik\");\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  chatElement\n);\n"],"sourceRoot":""}