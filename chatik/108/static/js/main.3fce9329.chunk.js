(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{21:function(e,t,a){},79:function(e,t,a){"use strict";a.r(t);var n=a(2),s=a(36),c=a.n(s),o=a(9),r=(a(21),a(12)),i=a.n(r),l=a(23),u=a.n(l),j=a(5),d=Object(n.createContext)();function p(e){var t=Object(n.useState)(null),a=Object(o.a)(t,2),s=a[0],c=a[1],r=Object(n.useState)(""),l=Object(o.a)(r,2),p=l[0],h=l[1],m=Object(n.useState)(""),g=Object(o.a)(m,2),b=g[0],f=g[1],O=u.a.get("PHPSESSID"),v=u.a.get();return Object(n.useEffect)((function(){b||i.a.get("https://youinroll.com/lib/ajax/getToken.php",{withCredentials:!0,headers:{Cookie:"PHPSESSID=".concat(O,";")}}).then((function(e){console.log(e),e&&e.data&&f(e.data.token)})).catch((function(e){return console.log(e)})),s&&(localStorage.setItem("loggeduserid",s),i.a.get("https://youinroll.com/profile/".concat(s,"/info?api=v1.1")).then((function(e){var t=e.data.response,a="";a=t.avatar.startsWith("https")?t.avatar:t.avatar.startsWith("uploads")?"https://react.semantic-ui.com/images/wireframe/square-image.png":"https://youinroll.com/"+t.avatar,t.avatar=a,h(t)})).catch((function(e){return console.log(e)})))}),[s,O,v]),Object(j.jsx)(d.Provider,{value:{user:s,token:b,userdata:p,setUser:c},children:e.children})}var h=a(38),m=a(24);m.a.initializeApp({apiKey:"AIzaSyDuozD3WtKHl4YxXnqFNhKyAmnHkFvJphM",authDomain:"youinrol.firebaseapp.com",projectId:"youinrol",storageBucket:"youinrol.appspot.com",messagingSenderId:"477697040270",appId:"1:477697040270:web:f944c28e376a88777d0edf"});var g=m.a,b=function(){return Object(j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-send",children:[Object(j.jsx)("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),Object(j.jsx)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})};function f(){var e=Object(n.useState)(""),t=Object(o.a)(e,2),a=t[0],s=t[1],c=Object(n.useContext)(d).token,r=window.location.href.split("/")[4],l=Object(n.useState)(localStorage.getItem("stream-".concat(r))||!1),u=Object(o.a)(l,2);u[0],u[1];Object(n.useEffect)((function(){var e=g.messaging();e.requestPermission().then((function(){return console.log("all good"),e.getToken()})).then((function(e){console.log(e),i.a.post("https://youinroll.com/regPushToken?api=1.0",{access_token:c,push_token:e})})).catch((function(e){return console.log(e)}))}),[]);var p=function(){/\S/.test(a)&&i.a.post("https://youinroll.com/message/send?api=1.0",{peer_id:"s".concat(r),message:a,access_token:c}).then((function(e){console.log(e),s("")})).catch((function(e){console.log(e)}))};return Object(j.jsx)("form",{onSubmit:function(e){e.preventDefault(),p()},children:Object(j.jsxs)("div",{className:"chatFooter",children:[Object(j.jsx)(h.a,{value:a,className:"messageImput",onChange:function(e){return s(e)},cleanOnEnter:!0,onFocus:function(){var e=document.getElementsByClassName("react-emoji")[0];e.style.background="white",e.style.border="2px solid #9147ff ",(e=document.getElementsByClassName("react-input-emoji--wrapper")[0]).style.background="white"},onEnter:p,placeholder:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",groupNames:{smileys_people:"\u041f\u0440\u043e\u0441\u0442\u044b\u0435 \u0441\u043c\u0430\u0439\u043b\u044b",animals_nature:"\u0416\u0438\u0432\u043e\u0442\u043d\u044b\u0435 \u043f\u0440\u0438\u0440\u043e\u0434\u0430",food_drink:"\u0415\u0434\u0430 \u0438 \u043d\u0430\u043f\u0438\u0442\u043a\u0438",travel_places:"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f",activities:"\u0421\u043f\u043e\u0440\u0442",objects:"\u041e\u0431\u044a\u0435\u043a\u0442\u044b",symbols:"\u0421\u0438\u043c\u0432\u043e\u043b\u044b",flags:"\u0424\u043b\u0430\u0433\u0438"}}),Object(j.jsx)("div",{className:"messageSend",children:Object(j.jsx)("button",{className:"footerButton",type:"submit",children:Object(j.jsx)(b,{})})})]})})}var O=a(13),v=a.n(O),x=a(15),y=a(17),S=a(37);function k(e){var t=e.mseg,a=Object(n.useState)(null),s=Object(o.a)(a,2),c=s[0],r=s[1];return Object(n.useEffect)((function(){i.a.get("https://youinroll.com/profile/".concat(t.user_id,"/info?api=v1.1")).then((function(e){var t=e.data.response,a="";a=t.avatar.startsWith("https")?t.avatar:t.avatar.startsWith("uploads")?"https://react.semantic-ui.com/images/wireframe/square-image.png":"https://youinroll.com/"+t.avatar,t.avatar=a,r(t)})).catch((function(e){return console.log(e)}))}),[]),Object(j.jsx)("div",{className:"chatMsg",children:Object(j.jsxs)("span",{className:"authorSpan",children:[c&&Object(j.jsx)("img",{className:"chatMsgImg",src:c.avatar,alt:c.name}),Object(j.jsxs)("span",{children:[c&&Object(j.jsx)("b",{className:"userNamedec",children:"".concat(c.name.trim(),": ")}),Object(j.jsx)(S.EmojioneV4,{svg:!0,text:t.message})]})]})})}function w(e){var t=e.toscroll,a=Object(n.useState)([]),s=Object(o.a)(a,2),c=s[0],r=s[1],l=Object(n.useState)(0),u=Object(o.a)(l,2),d=u[0],p=u[1],h=Object(n.useState)(!1),m=Object(o.a)(h,2),g=m[0],b=m[1],f=Object(n.useRef)(null),O=function(){var e=document.getElementById("chatmsgsall");e.scrollTop=e.scrollHeight},S=window.location.href.split("/")[4];function w(){return N.apply(this,arguments)}function N(){return(N=Object(y.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("in getrecent"),i.a.get("https://youinroll.com/listen/stream?api=1.0&stream_id=".concat(S,"&ts=").concat(d)).then((function(e){if(console.log(e),e.data&&"timeout"===e.data.response)console.log("timeout");else if(e.data&&e.data.response&&Array.isArray([e.data.response])){console.log("Is array");var a=e.data.response.slice(0,parseInt(e.data.response[0].id)-d);r([].concat(Object(x.a)(c),Object(x.a)(a.reverse()))),p(parseInt(e.data.response[0].id)),t&&O()}b(!g)})).catch((function(e){console.log(e),b(!g)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){if(console.log("in useeffect chatmain"),0===d&&0===c.length){var e={user_id:456,message:"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u043a\u043e\u043c\u043d\u0430\u0442\u0443 \u043f\u0440\u044f\u043c\u043e\u0433\u043e \u044d\u0444\u0438\u0440\u0430 \u0432 YouinRoll! \u041e\u0431\u0449\u0430\u0439\u0442\u0435\u0441\u044c \u0441 \u0432\u0435\u0434\u0443\u0449\u0438\u043c \u0438 \u0437\u0440\u0438\u0442\u0435\u043b\u044f\u043c\u0438 \u0438 \u043d\u0435 \u0437\u0430\u0431\u044b\u0432\u0430\u0439\u0442\u0435 \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430, \u0447\u0442\u043e\u0431\u044b \u044d\u0442\u0430 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u044f \u0431\u044b\u043b\u0430 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0439 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430."};i.a.get("https://youinroll.com/message/getAll?api=1.0&peer_id=s".concat(S)).then((function(a){if(a.data.response.length>0){p(parseInt(a.data.response[0].id));var n=a.data.response.slice(0,parseInt(a.data.response[0].id)-d);r([].concat(Object(x.a)(c),Object(x.a)(n.reverse()),[e]))}else r([e]),w();b(!g),t&&O()})).catch((function(e){console.log(e)}))}else w()}),[g]),Object(j.jsxs)(j.Fragment,{children:[c.map((function(e){return Object(j.jsx)(k,{mseg:e},e.id)})),Object(j.jsx)("div",{ref:f})]})}function N(){return Object(j.jsx)("div",{className:"chatHeader",children:Object(j.jsx)("div",{children:Object(j.jsx)("h3",{children:"\u0427\u0410\u0422 \u0422\u0420\u0410\u041d\u0421\u041b\u042f\u0426\u0418\u0418"})})})}function I(){var e=Object(n.useState)(!0),t=Object(o.a)(e,2),a=t[0],s=(t[1],Object(n.useState)(window.scrollY)),c=Object(o.a)(s,2);c[0],c[1];return Object(j.jsx)(p,{children:Object(j.jsx)("div",{className:"App",children:Object(j.jsxs)("div",{className:"chatWrapper",children:[Object(j.jsx)(N,{}),Object(j.jsx)("div",{className:"chatmain",id:"chatmsgsall",onScroll:function(e){console.log(e)},children:Object(j.jsx)(w,{toscroll:a})}),Object(j.jsx)(f,{})]})})})}var E=document.getElementById("chatik");c.a.render(Object(j.jsx)(n.StrictMode,{children:Object(j.jsx)(I,{})}),E)}},[[79,1,2]]]);
//# sourceMappingURL=main.3fce9329.chunk.js.map