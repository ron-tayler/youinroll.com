{"version":3,"sources":["UserContext.js","ChatFooter.js","ChatMain.js","App.js","index.js"],"names":["UserContext","createContext","UserContextProvider","props","useState","userid","setUser","userdata","setUserData","token","setToken","phpsession","Cookies","get","all_cooks","useEffect","axios","withCredentials","headers","Cookie","then","res","console","log","data","catch","e","localStorage","setItem","resp","uData","response","avaurl","avatar","startsWith","err","Provider","value","user","children","SendIcon","xmlns","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","className","x1","y1","x2","y2","points","ChatFooter","chatMessage","setChatMessage","useContext","stream_id","window","location","href","split","getItem","postMsg","test","post","peer_id","message","access_token","error","onSubmit","event","preventDefault","onChange","cleanOnEnter","onEnter","placeholder","groupNames","smileys_people","animals_nature","food_drink","travel_places","activities","objects","symbols","flags","type","ChatMessage","mseg","userData","user_id","src","alt","name","trim","svg","text","ChatMain","toscroll","msgs","setMsgs","offset","setOffSet","toRebuild","setToRebuild","myRef","useRef","executeScroll","current","scrollIntoView","getRecent","a","Array","isArray","newMsgs","slice","parseInt","id","reverse","er","firstMessage","length","map","msg","ref","ChatHeader","App","scrollY","onScroll","chatElement","document","getElementById","ReactDOM","render"],"mappings":"0NAIaA,EAAcC,0BAEZ,SAASC,EAAoBC,GAIxC,MAA4BC,mBAAS,MAArC,mBAAQC,EAAR,KAAgBC,EAAhB,KACA,EAAkCF,mBAAS,IAA3C,mBAAQG,EAAR,KAAkBC,EAAlB,KACA,EAA4BJ,mBAAS,IAArC,mBAAQK,EAAR,KAAeC,EAAf,KAEMC,EAAaC,IAAQC,IAAI,aAEzBC,EAAYF,IAAQC,MAkD1B,OA5CAE,qBAAU,WAODN,GACAO,IACIH,IAAI,8CACG,CACAI,iBAAiB,EACjBC,QAAS,CAAEC,OAAO,aAAD,OAAeR,EAAf,QAExBS,MAAK,SAACC,GACHC,QAAQC,IAAIF,GACZA,GAAOA,EAAIG,MAAQd,EAASW,EAAIG,KAAKf,UAGxCgB,OAAM,SAACC,GAAD,OAAQJ,QAAQC,IAAIG,MAI/BrB,IACAsB,aAAaC,QAAQ,eAAgBvB,GACrCW,IAAMH,IAAN,wCAA2CR,EAA3C,mBACCe,MAAK,SAACS,GACH,IAAIC,EAAQD,EAAKL,KAAKO,SAClBC,EAAS,GAETA,EADAF,EAAMG,OAAOC,WAAW,SACfJ,EAAMG,OACTH,EAAMG,OAAOC,WAAW,WACrB,kEAGA,yBAA2BJ,EAAMG,OAE9CH,EAAMG,OAASD,EACfxB,EAAYsB,MAEfL,OAAM,SAACU,GAAD,OAASb,QAAQC,IAAIY,SAEjC,CAAC9B,EAAQM,EAAYG,IAGpB,cAACd,EAAYoC,SAAb,CAAsBC,MAAO,CAACC,KAAMjC,EAAQI,QAAOF,WAAUD,WAA7D,SACKH,EAAMoC,W,YC5DbC,EAAW,kBACf,sBACEC,MAAM,6BACNC,MAAM,KACNC,OAAO,KACPC,QAAQ,YACRC,KAAK,OACLC,OAAO,eACPC,YAAY,IACZC,cAAc,QACdC,eAAe,QACfC,UAAU,uBAVZ,UAYE,sBAAMC,GAAG,KAAKC,GAAG,IAAIC,GAAG,KAAKC,GAAG,OAChC,yBAASC,OAAO,kCAIL,SAASC,IACtB,MAAsCpD,mBAAS,IAA/C,mBAAOqD,EAAP,KAAoBC,EAApB,KACOjD,EAASkD,qBAAW3D,GAApBS,MAEDmD,EAAYC,OAAOC,SAASC,KAAKC,MAAM,KAAK,GAClD,EAAwC5D,mBAASuB,aAAasC,QAAb,iBAA+BL,MAAgB,GAAhG,mBAaMM,GAbN,UAagB,WACV,KAAKC,KAAKV,IACZzC,IACGoD,KADH,6CACsD,CAClDC,QAAQ,IAAD,OAAMT,GACbU,QAASb,EACTc,aAAc9D,IAGfW,MAAK,SAAUW,GACdT,QAAQC,IAAIQ,GACZ2B,EAAe,OAEhBjC,OAAM,SAAU+C,GACflD,QAAQC,IAAIiD,QAiBpB,OACE,sBAAMC,SAZS,SAACC,GAChBA,EAAMC,iBACNT,KAUA,SACE,sBAAKhB,UAAU,aAAf,UACE,cAAC,IAAD,CACEb,MAAOoB,EACPP,UAAU,eACV0B,SAAU,SAAClD,GAAD,OAAOgC,EAAehC,IAChCmD,cAAY,EACZC,QAASZ,EACTa,YAAY,gHACZC,WAAY,CACVC,eAAgB,kFAChBC,eAAgB,8FAChBC,WAAY,uEACZC,cAAe,qEACfC,WAAY,iCACZC,QAAS,6CACTC,QAAS,6CACTC,MAAO,oCAeX,qBAAKtC,UAAU,cAAf,SACE,wBAAQA,UAAU,eAAeuC,KAAK,SAAtC,SACE,cAAC,EAAD,a,0CCrGZ,SAASC,EAAT,GAAgC,IAATC,EAAQ,EAARA,KAErB,EAAkCvF,mBAAS,MAA3C,mBAAQwF,EAAR,KAAkBpF,EAAlB,KAwBA,OAtBAO,qBAAU,WACRC,IAAMH,IAAN,wCAA2C8E,EAAKE,QAAhD,mBACWzE,MAAK,SAACS,GACH,IAAIC,EAAQD,EAAKL,KAAKO,SAElBC,EAAS,GAETA,EADAF,EAAMG,OAAOC,WAAW,SACfJ,EAAMG,OACTH,EAAMG,OAAOC,WAAW,WACrB,kEAGA,yBAA2BJ,EAAMG,OAE9CH,EAAMG,OAASD,EAGfxB,EAAYsB,MAEfL,OAAM,SAACU,GAAD,OAASb,QAAQC,IAAIY,QACtC,IAGA,qBAAKe,UAAU,UAAf,SACE,uBAAMA,UAAU,aAAhB,UACG0C,GAAY,qBAAM1C,UAAU,aAAa4C,IAAKF,EAAS3D,OAAQ8D,IAAKH,EAASI,OAC9E,iCACGJ,GAAY,mBAAG1C,UAAU,cAAb,mBAA+B0C,EAASI,KAAKC,OAA7C,QACb,cAAC,aAAD,CAAYC,KAAG,EAACC,KAAMR,EAAKrB,kBAOtB,SAAS8B,EAAT,GAAiC,IAAbC,EAAY,EAAZA,SACjC,EAAwBjG,mBAAS,IAAjC,mBAAOkG,EAAP,KAAaC,EAAb,KACA,EAA4BnG,mBAAS,GAArC,mBAAOoG,EAAP,KAAeC,EAAf,KACA,EAAoCrG,oBAAS,GAA7C,mBAAQsG,EAAR,KAAmBC,EAAnB,KACMC,EAAQC,iBAAO,MACfC,EAAgB,kBAAMF,EAAMG,QAAQC,kBAGpCpD,EAAYC,OAAOC,SAASC,KAAKC,MAAM,KAAK,GARL,SAY9BiD,IAZ8B,2EAY7C,sBAAAC,EAAA,sDACE5F,QAAQC,IAAI,gBACZP,IAAMH,IAAN,gEAAmE+C,EAAnE,eAAmF4C,IAChFpF,MAAK,SAACW,GAEL,GADAT,QAAQC,IAAIQ,GACRA,EAASP,MAAmC,YAA3BO,EAASP,KAAKO,SAC/BT,QAAQC,IAAI,gBACT,GAAIQ,EAASP,MAAQO,EAASP,KAAKO,UAAYoF,MAAMC,QAAQ,CAACrF,EAASP,KAAKO,WAAY,CAC7FT,QAAQC,IAAI,YACZ,IAAI8F,EAAUtF,EAASP,KAAKO,SAASuF,MAAM,EAAGC,SAASxF,EAASP,KAAKO,SAAS,GAAGyF,IAAMhB,GACvFD,EAAQ,GAAD,mBAAKD,GAAL,YAAce,EAAQI,aAC7BhB,EAAUc,SAASxF,EAASP,KAAKO,SAAS,GAAGyF,KAC7CnB,GAAYS,IAEdH,GAAcD,MAEfjF,OAAM,SAACiG,GACNpG,QAAQC,IAAImG,GACZf,GAAcD,MAlBpB,4CAZ6C,sBAuE7C,OApCA3F,qBAAU,WAER,GADAO,QAAQC,IAAI,yBACG,IAAXiF,EAAa,CACf,IAAImB,EAAe,CACjB9B,QAAS,IACTvB,QAAS,+4BAEXtD,IACGH,IADH,gEACiE+C,IAG9DxC,MAAK,SAACW,GAEL,GAAIA,EAASP,KAAKO,SAAS6F,OAAS,GAClC,GAAI7F,EAASP,KAAKO,SAAS,GAAGyF,GAAKhB,EAAO,CACxCC,EAAUc,SAASxF,EAASP,KAAKO,SAAS,GAAGyF,KAC7C,IAAIH,EAAUtF,EAASP,KAAKO,SAASuF,MAAM,EAAGC,SAASxF,EAASP,KAAKO,SAAS,GAAGyF,IAAMhB,GACvFD,EAAQ,GAAD,mBAAKD,GAAL,YAAce,EAAQI,WAAtB,CAAiCE,WAI1CV,IAEFN,GAAcD,GACdL,GAAYS,OAGbrF,OAAM,SAAC+C,GACNlD,QAAQC,IAAIiD,WAGhByC,MAGD,CAACP,IAGF,qCACGJ,EAAKuB,KAAI,SAACC,GAAD,OACR,cAACpC,EAAD,CAA0BC,KAAMmC,GAAdA,EAAIN,OAExB,qBAAKO,IAAKnB,OChHhB,SAASoB,IACP,OACE,sBAAK9E,UAAU,aAAf,UACE,8BACE,mHAEF,qBAAKA,UAAU,gBAAf,SACE,qBACE4C,IAAI,6EACJC,IAAI,mBAOC,SAASkC,IAEtB,MAAkC7H,oBAAS,GAA3C,mBAAQiG,EAAR,KACA,GADA,KACkBjG,mBAASyD,OAAOqE,UAAlC,6BAMA,OACE,cAAChI,EAAD,UACE,qBAAKgD,UAAU,MAAf,SACE,sBAAKA,UAAU,cAAf,UACE,cAAC8E,EAAD,IACA,qBAAK9E,UAAU,WAAWiF,SATT,SAACzD,GACxBpD,QAAQC,IAAImD,IAQN,SACE,cAAC0B,EAAD,CAAWC,SAAUA,MAEvB,cAAC7C,EAAD,WCxCV,IAAM4E,EAAcC,SAASC,eAAe,UAC5CC,IAASC,OACP,cAAC,aAAD,UACE,cAACP,EAAD,MAEFG,K","file":"static/js/main.46c10718.chunk.js","sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport Cookies from 'js-cookie';\n\nexport const UserContext = createContext();\n\nexport default function UserContextProvider(props){\n\n\n\n    const [ userid, setUser ] = useState(null);  // localStorage.getItem('loggeduserid') || \"\"\n    const [ userdata, setUserData ] = useState(\"\");\n    const [ token, setToken ] = useState(\"\");\n\n    const phpsession = Cookies.get('PHPSESSID');\n\n    const all_cooks = Cookies.get();\n\n    \n\n    \n  \n    useEffect(() => { \n\n        /* for (const property in all_cooks) {\n            console.log(`${property}: ${all_cooks[property]}`);\n            property[0] !== '_' && property !== 'PHPSESSID' && property.length > 8 && setUser(all_cooks[property]);\n        } */\n\n        if (!token)\n            {axios\n                .get(\"https://youinroll.com/lib/ajax/getToken.php\",\n                        { \n                        withCredentials: true,\n                        headers: { Cookie: `PHPSESSID=${phpsession};`}\n                    })\n                .then((res) => {\n                    console.log(res)\n                    res && res.data && setToken(res.data.token);\n                   // res && res.data && res.data.token && localStorage.setItem('token', res.data.token);\n                })\n                .catch((e) =>  console.log(e)); \n            }\n        \n        \n        if (userid){\n            localStorage.setItem('loggeduserid', userid)        \n            axios.get(`https://youinroll.com/profile/${userid}/info?api=v1.1`)\n            .then((resp) => {\n                let uData = resp.data.response;\n                let avaurl = \"\";\n                if (uData.avatar.startsWith('https')){\n                    avaurl = uData.avatar;\n                }else if (uData.avatar.startsWith('uploads')){\n                    avaurl = 'https://react.semantic-ui.com/images/wireframe/square-image.png';\n                }\n                else{\n                    avaurl = \"https://youinroll.com/\" + uData.avatar;\n                };\n                uData.avatar = avaurl;                \n                setUserData(uData);                \n            })\n            .catch((err) => console.log(err))\n        }\n    }, [userid, phpsession, all_cooks])\n    \n    return(\n        <UserContext.Provider value={{user: userid, token, userdata, setUser}}>\n            {props.children}\n        </UserContext.Provider>\n    );\n}","import \"./styles.css\";\nimport EmojiPicker from \"./EmojiPicker\";\nimport { useState, useContext } from \"react\";\nimport axios from \"axios\";\nimport { UserContext } from './UserContext';\nimport InputEmoji from \"react-input-emoji\";\n\n\nconst SendIcon = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    stroke=\"currentColor\"\n    strokeWidth=\"2\"\n    strokeLinecap=\"round\"\n    strokeLinejoin=\"round\"\n    className=\"feather feather-send\"\n  >\n    <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n    <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\n  </svg>\n);\n\nexport default function ChatFooter() {\n  const [chatMessage, setChatMessage] = useState(\"\");\n  const {token} = useContext(UserContext);\n  // const stream_id = 123;\n  const stream_id = window.location.href.split('/')[4];\n  const [ rulesaccept, setRulesAccept ] = useState(localStorage.getItem(`stream-${stream_id}`) || false);\n\n  \n  const checkRulesAccept = () => {\n    console.log(\"dsa\");\n  }\n\n \n\n /*  const addEmoji = (emoj) => {\n    setChatMessage(chatMessage + emoj);\n  }; */\n\n  const postMsg = () => {\n    if (/\\S/.test(chatMessage)) {     \n      axios\n        .post(`https://youinroll.com/message/send?api=1.0`, {\n          peer_id: `s${stream_id}`,\n          message: chatMessage,\n          access_token: token,\n            //\"50d56c2af74e7f0656fcfa28d663a94c9e338a6e5b9825ab2749d95e8895420137628a75d3a2d99ab1b0756ff9872cfdb555e1dc3cc48ae6fa454c44b0bfd5ee\"\n        })\n        .then(function (response) {\n          console.log(response);\n          setChatMessage(\"\");\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    }\n\n  }\n\n  const sendData = (event) => {   \n    event.preventDefault();\n    postMsg();\n  };\n\n  /* const pressEnter = (e) => {\n    if (e.key === 'Enter') {\n      sendData(e);      \n    }\n  } */\n\n  return (\n    <form onSubmit={sendData}>\n      <div className=\"chatFooter\"> \n        <InputEmoji\n          value={chatMessage}\n          className=\"messageImput\"\n          onChange={(e) => setChatMessage(e)}\n          cleanOnEnter\n          onEnter={postMsg}\n          placeholder=\"Отправить сообщение\"\n          groupNames={{\n            smileys_people: \"Простые смайлы\",\n            animals_nature: \"Животные природа\",\n            food_drink: \"Еда и напитки\",\n            travel_places: \"Путешествия\",\n            activities: \"Спорт\",\n            objects: \"Объекты\",\n            symbols: \"Символы\",\n            flags: \"Флаги\"\n          }}\n        />\n\n        {/* <input\n          className=\"messageImput\"\n          placeholder=\"Сообщение\"\n          value={chatMessage}        \n          onChange={(e) => setChatMessage(e.target.value)}\n          onKeyDown={pressEnter}\n         \n        /> */}\n        {/* <div className=\"emojidiv\">\n          <EmojiPicker addEmoji={addEmoji} />\n        </div>  */}\n        <div className=\"messageSend\">\n          <button className=\"footerButton\" type=\"submit\">\n            <SendIcon />\n          </button>\n        </div>        \n      </div>\n    </form>\n  );\n}\n","import \"./styles.css\";\nimport { useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\n\nimport {  EmojioneV4 } from \"react-emoji-render\";\n\n\n\n\nfunction ChatMessage({ mseg }) {\n\n  const [ userData, setUserData ] = useState(null);\n  \n  useEffect(() => {\n    axios.get(`https://youinroll.com/profile/${mseg.user_id}/info?api=v1.1`)\n              .then((resp) => {\n                  let uData = resp.data.response;\n                //  console.log(resp);\n                  let avaurl = \"\";\n                  if (uData.avatar.startsWith('https')){\n                      avaurl = uData.avatar;\n                  }else if (uData.avatar.startsWith('uploads')){\n                      avaurl = 'https://react.semantic-ui.com/images/wireframe/square-image.png';\n                  }\n                  else{\n                      avaurl = \"https://youinroll.com/\" + uData.avatar;\n                  };\n                  uData.avatar = avaurl; \n                  \n                 // console.log(uData);\n                  setUserData(uData);                \n              })\n              .catch((err) => console.log(err))\n  },[]);\n\n  return (\n    <div className=\"chatMsg\">\n      <span className=\"authorSpan\"> \n        {userData && <img  className=\"chatMsgImg\" src={userData.avatar} alt={userData.name} />}\n        <span>\n          {userData && <b className=\"userNamedec\">{`${userData.name.trim()}: `}</b> }\n          <EmojioneV4 svg text={mseg.message} />\n        </span>\n      </span>      \n    </div>\n  );\n}\n\nexport default function ChatMain({ toscroll }) {\n  const [msgs, setMsgs] = useState([]);\n  const [offset, setOffSet] = useState(0);\n  const [ toRebuild, setToRebuild ] = useState(false);\n  const myRef = useRef(null);\n  const executeScroll = () => myRef.current.scrollIntoView() \n\n // const stream_id = 123;\n  const stream_id = window.location.href.split('/')[4];\n\n\n  \n  async function getRecent() { \n    console.log('in getrecent');\n    axios.get(`https://youinroll.com/listen/stream?api=1.0&stream_id=${stream_id}&ts=${offset}`)\n      .then((response) => { \n        console.log(response); \n        if (response.data && response.data.response === \"timeout\"){\n            console.log(\"timeout\")  \n        } else if (response.data && response.data.response && Array.isArray([response.data.response])) {\n          console.log(\"Is array\");\n          let newMsgs = response.data.response.slice(0, parseInt(response.data.response[0].id) - offset);\n          setMsgs([...msgs, ...newMsgs.reverse()] );\n          setOffSet(parseInt(response.data.response[0].id))          \n          toscroll && executeScroll();\n        }        \n        setToRebuild(!toRebuild);\n      })\n      .catch((er) => {\n        console.log(er);\n        setToRebuild(!toRebuild);\n      })\n  }\n   \n\n  useEffect(() => {\n    console.log('in useeffect chatmain');\n    if (offset === 0){\n      let firstMessage = {\n        user_id: 456,\n        message: 'Добро пожаловать в комнату прямого эфира в YouinRoll! Общайтесь с ведущим и зрителями и не забывайте соблюдать правила сообщества, чтобы эта трансляция была безопасной для просмотра.'\n      };          \n      axios \n        .get( `https://youinroll.com/message/getAll?api=1.0&peer_id=s${stream_id}`\n        // `https://youinroll.com/listen/stream?api=1.0&stream_id=s${stream_id}&access_token=${access_token}`\n        )\n        .then((response) => {  \n          \n          if (response.data.response.length > 0){\n            if (response.data.response[0].id > offset){\n              setOffSet(parseInt(response.data.response[0].id));\n              let newMsgs = response.data.response.slice(0, parseInt(response.data.response[0].id) - offset);\n              setMsgs([...msgs, ...newMsgs.reverse(), firstMessage] );             \n            }        \n            //console.log(response.data.response[0].id)\n          } else {\n            getRecent();\n          }\n          setToRebuild(!toRebuild);\n          toscroll && executeScroll();    \n        // console.log(response.data.response[-1]);            \n        })              \n        .catch((error) => {\n          console.log(error);          \n        });\n    }else {\n      getRecent();\n    }\n     \n  }, [toRebuild]);\n\n  return (\n    <>\n      {msgs.map((msg) => (\n        <ChatMessage key={msg.id} mseg={msg}  />\n      ))}\n      <div ref={myRef}></div>  \n    </>\n  );\n}\n","import  { useState } from \"react\";\nimport ChatFooter from \"./ChatFooter\";\nimport \"./styles.css\";\nimport ChatMain from \"./ChatMain\";\nimport UserContextProvider from \"./UserContext\";\n\n// import { useEffect } from \"react\";\n\n// import RocketChatApi from 'rocketchat-api';\n\n//const rocketChatClient = new RocketChatApi('http','chat.smartfooded.com',3000);\n\nfunction ChatHeader() {\n  return (\n    <div className=\"chatHeader\">\n      <div>\n        <h3>ЧАТ ТРАНСЛЯЦИИ</h3>\n      </div>\n      <div className=\"chatHeaderImg\">\n        <img\n          src=\"https://youinroll.com/storage/media/ac9ff41aee4b2ebd3ea900551bb2bce6-1.jpg\"\n          alt=\"asdfjsdfa\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default function App() {\n\n  const [ toscroll, setToScroll ] = useState(true);\n  const [y, setY] = useState(window.scrollY);\n  \n  const scrollDownButton = (event) => {\n    console.log(event);\n  }\n\n  return (\n    <UserContextProvider>\n      <div className=\"App\">\n        <div className=\"chatWrapper\">\n          <ChatHeader />\n          <div className=\"chatmain\" onScroll={scrollDownButton}>\n            <ChatMain  toscroll={toscroll} />            \n          </div>\n          <ChatFooter />\n        </div>\n      </div>\n    </UserContextProvider>\n  );\n}\n","import { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nconst chatElement = document.getElementById(\"chatik\");\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  chatElement\n);\n"],"sourceRoot":""}